<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cast Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .cast-image {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }

    .cast-details {
      padding: 20px;
    }

    .section-title {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.5rem;
      color: #333;
    }

    .movie-card {
      min-width: 200px;
      max-width: 200px;
      flex-shrink: 0;
      text-align: center;
    }

    .movie-card img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      border-radius: 10px;
    }
    .homepage-icon {
      font-size: 1.5rem;
      color: #007bff; /* M√†u xanh d∆∞∆°ng */
      margin-right: 5px;
      vertical-align: middle;
    }

    a:hover .homepage-icon {
      color: #0056b3; /* M√†u xanh d∆∞∆°ng ƒë·∫≠m h∆°n khi hover */
    }
  </style>
</head>
<body>
<div th:replace="components/header :: header"></div>

<div class="container mt-5">
  <!-- Cast Information -->
  <div id="cast-container" class="row">
    <!-- Th√¥ng tin di·ªÖn vi√™n s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
  </div>
  <!-- N√∫t Y√™u Th√≠ch trong th√¥ng tin di·ªÖn vi√™n -->
  <button id="favorite-btn" class="btn btn-outline-danger">
    <i class="fas fa-heart"></i> Y√™u Th√≠ch
  </button>


  <!-- Movies Section -->
  <div class="mt-5">
    <h2 class="section-title text-center">üé¨ C√°c Phim ƒë√£ Tham Gia</h2>
    <div id="movies-list" class="row justify-content-center">
      <!-- Danh s√°ch phim s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
    </div>
  </div>
</div>

<script>
  const API_KEY = '5b3554c90c5c911c652788f8b65db269';

  // L·∫•y personId t·ª´ URL
  const urlParams = new URLSearchParams(window.location.search);
  const personId = urlParams.get('personId');

  // API URLs
  const personApiUrl = `https://api.themoviedb.org/3/person/${personId}?api_key=${API_KEY}&language=en-US`;
  const movieCreditsApiUrl = `https://api.themoviedb.org/3/person/${personId}/movie_credits?api_key=${API_KEY}&language=en-US`;

  // G·ªçi API l·∫•y th√¥ng tin di·ªÖn vi√™n
  async function fetchCastDetails() {
    try {
      const response = await fetch(personApiUrl);
      if (!response.ok) {
        throw new Error('Kh√¥ng th·ªÉ l·∫•y th√¥ng tin di·ªÖn vi√™n');
      }

      const cast = await response.json();
      displayCastDetails(cast);
    } catch (error) {
      console.error('L·ªói khi l·∫•y th√¥ng tin di·ªÖn vi√™n:', error);
      document.getElementById('cast-container').innerHTML = '<p class="text-danger">Kh√¥ng th·ªÉ t·∫£i th√¥ng tin di·ªÖn vi√™n.</p>';
    }
  }

  // G·ªçi API l·∫•y danh s√°ch phim
  async function fetchMovieCredits() {
    try {
      const response = await fetch(movieCreditsApiUrl);
      if (!response.ok) {
        throw new Error('Kh√¥ng th·ªÉ l·∫•y danh s√°ch phim');
      }

      const credits = await response.json();
      displayMovies(credits.cast);
    } catch (error) {
      console.error('L·ªói khi l·∫•y danh s√°ch phim:', error);
      document.getElementById('movies-list').innerHTML = '<p class="text-danger">Kh√¥ng th·ªÉ t·∫£i danh s√°ch phim.</p>';
    }
  }

  // Hi·ªÉn th·ªã th√¥ng tin di·ªÖn vi√™n
  function displayCastDetails(cast) {
    const container = document.getElementById('cast-container');
    container.innerHTML = `
        <div class="col-md-4">
            <img src="https://image.tmdb.org/t/p/w500${cast.profile_path}" alt="${cast.name}" class="cast-image" onerror="this.onerror=null;this.src='https://via.placeholder.com/200';">
        </div>
        <div class="col-md-8 cast-details">
            <h1>${cast.name}</h1>
            <p><strong>Ng√†y sinh:</strong> ${cast.birthday || 'Kh√¥ng r√µ'}</p>
            <p><strong>N∆°i sinh:</strong> ${cast.place_of_birth || 'Kh√¥ng r√µ'}</p>
            <p><strong>Ti·ªÉu s·ª≠:</strong> ${cast.biography || 'Kh√¥ng c√≥ th√¥ng tin.'}</p>
            <p><strong>Bi·ªát danh:</strong> ${cast.also_known_as.length > 0 ? cast.also_known_as.join(', ') : 'Kh√¥ng c√≥'}</p>
            <p><strong>Gi·ªõi t√≠nh:</strong> ${cast.gender === 1 ? 'N·ªØ' : 'Nam'}</p>
            <p><strong>ƒê·ªô ph·ªï bi·∫øn:</strong> ${cast.popularity || 'Kh√¥ng r√µ'}</p>
            ${
        cast.homepage
            ? `<a href="${cast.homepage}" target="_blank" style="text-decoration: none; color: inherit;" data-bs-toggle="tooltip" data-bs-placement="top" title="Visit Homepage">
                    <i class="fas fa-home homepage-icon"></i> Trang c√° nh√¢n
                </a>`
            : `<p class="text-danger">Kh√¥ng c√≥ th√¥ng tin trang c√° nh√¢n.</p>`
    }
        </div>
    `;
  }

  // Hi·ªÉn th·ªã danh s√°ch phim
  function displayMovies(movies) {
    const container = document.getElementById('movies-list');
    container.innerHTML = '';

    if (!movies || movies.length === 0) {
      container.innerHTML = '<p class="text-center">Kh√¥ng c√≥ phim n√†o.</p>';
      return;
    }

    movies.forEach(movie => {
      const movieCard = document.createElement('div');
      movieCard.className = 'col-md-3 mb-4 movie-card';
      movieCard.innerHTML = `
                <a href="/details?movieId=${movie.id}" style="text-decoration: none; color: inherit;">
                    <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
                    <h6>${movie.title}</h6>
                    <p><small>‚≠ê ${movie.vote_average} / 10 | (${movie.vote_count || '0'} votes) </small></p>
                    <p><small>Ng√†y ph√°t h√†nh: ${movie.release_date || 'N/A'}</small></p>
                </a>
            `;
      container.appendChild(movieCard);
    });
  }

  //luu danh sach dien vien
  document.getElementById('favorite-btn').addEventListener('click', () => {
    // L·∫•y danh s√°ch y√™u th√≠ch t·ª´ localStorage
    let favorites = JSON.parse(localStorage.getItem('favoriteActors')) || [];

    // Ki·ªÉm tra n·∫øu di·ªÖn vi√™n ƒë√£ t·ªìn t·∫°i trong danh s√°ch
    if (!favorites.some(actor => actor.id === personId)) {
      // Th√™m th√¥ng tin di·ªÖn vi√™n v√†o danh s√°ch
      favorites.push({
        id: personId,
        name: cast.name,
        profile_path: cast.profile_path,
      });
      localStorage.setItem('favoriteActors', JSON.stringify(favorites));
      alert('ƒê√£ th√™m v√†o danh s√°ch y√™u th√≠ch!');
    } else {
      alert('Di·ªÖn vi√™n n√†y ƒë√£ c√≥ trong danh s√°ch y√™u th√≠ch.');
    }
  });



  // G·ªçi h√†m khi t·∫£i trang
  fetchCastDetails();
  fetchMovieCredits();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
