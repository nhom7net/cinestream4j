<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieTime - Trang ch·ªß</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .movie-card {
            min-width: 200px;
            max-width: 200px;
            text-align: center;
        }

        .movie-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
        }

        .section-title {
            font-size: 1.5rem;
            margin: 20px 0;
        }

        .movie-section {
            overflow-x: auto;
            display: flex;
            gap: 15px;
        }

        .genre-button {
            margin: 5px;
        }
    </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
    <a class="navbar-brand fs-4" href="#">MovieTime</a>
    <!-- N√∫t chuy·ªÉn h∆∞·ªõng t·ªõi Top Rated -->
    <div class="text-center mt-4">
        <a href="/toprated" class="btn btn-warning btn-lg">üåü Top Rating</a>
    </div>
    <div class="text-center mt-4">
        <a href="/upcoming" class="btn btn-warning btn-lg">üåü New</a>
    </div>
    <div class="text-center mt-4">
        <a href="/nowplaying" class="btn btn-warning btn-lg">üåü Now Playing</a>
    </div>
    <div class="text-center mt-4">
        <a href="/people" class="btn btn-warning btn-lg">üåü Actor</a>
    </div>
    </div>
    <!-- N√∫t t√¨m ki·∫øm -->
    <form class="d-flex ms-auto" role="search" id="search-form">
        <input class="form-control me-2" id="search-input" type="search" placeholder="T√¨m ki·∫øm phim..." aria-label="Search">
        <button class="btn btn-outline-success" type="submit">T√¨m ki·∫øm</button>
    </form>
</nav>

<!-- Search Results -->
<div class="container my-5">
    <h2 class="section-title">üîç K·∫øt qu·∫£ t√¨m ki·∫øm</h2>
    <div id="search-results" class="movie-section">
        <!-- K·∫øt qu·∫£ t√¨m ki·∫øm s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
    </div>
</div>

<!-- Genres Section -->
<div class="container my-5">
    <h2 class="section-title">üìö Th·ªÉ lo·∫°i phim</h2>
    <div id="genre-list" class="d-flex flex-wrap justify-content-center">
        <!-- Danh s√°ch th·ªÉ lo·∫°i s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
    </div>
</div>

<div class="container my-5">
    <h2 class="section-title">üåü Phim Ph·ªï Bi·∫øn</h2>
    <div id="trending-movies" class="movie-section" th:each="movie: ${popular}">
        <div class="movie-card">
            <a href="/details?movieId=${movie.id}" style="text-decoration: none; color: inherit;">
                <img th:src="'https://image.tmdb.org/t/p/w500' + ${movie.poster_path}" th:alt="${movie.title}">
                <h6 th:text="${movie.title}"></h6>
                <p><small>‚≠ê <span th:text="${movie.vote_average}"></span> / 10 | (<span th:text="${movie.vote_count}"></span> votes) </small></p>
                <p><small>Ng√†y ph√°t h√†nh: <span th:text="${movie.release_date}"></span></small></p>
            </a>
        </div>
    </div>
</div>

<div class="container my-5">
    <h2 class="section-title">üî• Phim ƒêang Th·ªãnh H√†nh</h2>
    <div id="popular-movies" class="movie-section" th:each="movie: ${trending}">
        <div class="movie-card">
            <a href="/details?movieId=${movie.id}" style="text-decoration: none; color: inherit;">
                <img th:src="'https://image.tmdb.org/t/p/w500' + ${movie.poster_path}" th:alt="${movie.title}">
                <h6 th:text="${movie.title}"></h6>
                <p><small>‚≠ê <span th:text="${movie.vote_average}"></span> / 10 | (<span th:text="${movie.vote_count}"></span> votes) </small></p>
                <p><small>Ng√†y ph√°t h√†nh: <span th:text="${movie.release_date}"></span></small></p>
            </a>
        </div>
    </div>
</div>

<div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ms-auto">
        <li class="nav-item">
            <a class="nav-link active" href="/toprated">Top ƒê√°nh Gi√°</a>
        </li>
    </ul>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript Fetch API -->
<script>
    const API_KEY = '5b3554c90c5c911c652788f8b65db269';
    const BASE_URL = 'https://api.themoviedb.org/3';

    // X·ª≠ l√Ω t√¨m ki·∫øm phim
    document.getElementById('search-form').addEventListener('submit', async function (event) {
        event.preventDefault();
        const query = document.getElementById('search-input').value;
        if (query.trim() === '') return;

        const searchUrl = `${BASE_URL}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(query)}&language=vi-VN`;
        try {
            const response = await fetch(searchUrl);
            const data = await response.json();
            displayMovies(data.results, 'search-results');
        } catch (error) {
            console.error('L·ªói khi t√¨m ki·∫øm phim:', error);
        }
    });

    // G·ªçi API ƒë·ªÉ l·∫•y danh s√°ch th·ªÉ lo·∫°i
    async function fetchGenres() {
        const genreUrl = `${BASE_URL}/genre/movie/list?api_key=${API_KEY}&language=vi-VN`;
        try {
            const response = await fetch(genreUrl);
            const data = await response.json();
            displayGenres(data.genres);
        } catch (error) {
            console.error('L·ªói khi l·∫•y danh s√°ch th·ªÉ lo·∫°i:', error);
        }
    }

    // Hi·ªÉn th·ªã danh s√°ch th·ªÉ lo·∫°i
    function displayGenres(genres) {
        const container = document.getElementById('genre-list');
        container.innerHTML = '';

        genres.forEach(genre => {
            const button = document.createElement('button');
            button.className = 'btn btn-outline-primary genre-button';
            button.textContent = genre.name;
            button.onclick = () => {
                window.location.href = `/genres?genreId=${genre.id}&genreName=${encodeURIComponent(genre.name)}`;
            };
            container.appendChild(button);
        });
    }

    // Hi·ªÉn th·ªã phim l√™n giao di·ªán
    function displayMovies(movies, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';

        if (movies.length === 0) {
            container.innerHTML = '<p class="text-center">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£.</p>';
            return;
        }

        movies.forEach(movie => {
            const movieCard = document.createElement('div');
            movieCard.className = 'movie-card';
            movieCard.innerHTML = `
                <a href="/details?movieId=${movie.id}" style="text-decoration: none; color: inherit;">
                    <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
                    <h6>${movie.title}</h6>
                    <p><small>‚≠ê ${movie.vote_average} / 10 | (${movie.vote_count || '0'} votes) </small></p>
                    <p><small>Ng√†y ph√°t h√†nh: ${movie.release_date || 'N/A'}</small></p>
                </a>
            `;
            container.appendChild(movieCard);
        });
    }

    // G·ªçi API khi t·∫£i trang
    fetchGenres();
</script>

</body>
</html>
