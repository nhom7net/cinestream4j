<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Website</title>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet">
    <style>
        #movie-results {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 15px 0;
        }

        .movie-card {
            min-width: 200px;
            max-width: 200px;
            flex-shrink: 0;
            text-align: center;
        }

        .movie-card img {
            width: 200px;
            height: 300px;
            object-fit: cover;
        }

        .movie-card .card {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .movie-card .card-body {
            padding: 10px;
        }

        .movie-card .card-title {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .movie-card .card-text {
            font-size: 0.9rem;
        }
    </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
    <a class="navbar-brand fs-4" th:href="@{/}">MovieTime</a>

    <form class="d-flex" role="search" id="search-form">
        <input class="form-control me-2" id="search-input" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </form>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
            <li class="nav-item active">
                <a class="nav-link" th:href="@{/}">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/movies}">Movies</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/reviews}">Reviews</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/top-picks}">Top Picks</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">[[${name}]] @[[${username}]]</a>
            </li>
        </ul>
    </div>
</nav>

<!-- Movie Results -->
<div class="container my-5" id="movie-results">
    <!-- Search results will be displayed here -->
</div>

<!-- JavaScript -->
<script th:inline="javascript">
    const API_KEY = '5b3554c90c5c911c652788f8b65db269';
    const BASE_URL = 'https://api.themoviedb.org/3';

    document.getElementById('search-form').addEventListener('submit', async function (event) {
        event.preventDefault();
        const query = document.getElementById('search-input').value;
        const response = await fetch(`${BASE_URL}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(query)}`);
        const data = await response.json();
        displayResults(data.results);
    });

    function displayResults(movies) {
        const resultsContainer = document.getElementById('movie-results');
        resultsContainer.innerHTML = '';

        if (movies.length === 0) {
            resultsContainer.innerHTML = '<p class="text-center">No results found.</p>';
            return;
        }

        movies.forEach(movie => {
            const movieCard = document.createElement('div');
            movieCard.className = 'movie-card';
            movieCard.innerHTML = `
                <a href="/details?movieId=${movie.id}" style="text-decoration: none; color: inherit;">
                    <div class="card">
                        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" class="card-img-top" alt="${movie.title}">
                        <div class="card-body">
                            <h6 class="card-title">${movie.title}</h6>
                            <p class="card-text small">
                                Release Date: ${movie.release_date || 'N/A'}<br>
                                Rating: ${movie.vote_average || 'N/A'} (${movie.vote_count || '0'} votes)
                            </p>
                        </div>
                    </div>
                </a>
            `;
            resultsContainer.appendChild(movieCard);
        });
    }
</script>

<!-- Bootstrap JS -->
<script th:src="@{https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js}" crossorigin="anonymous"></script>
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js}" crossorigin="anonymous"></script>
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js}" crossorigin="anonymous"></script>

</body>
</html>
