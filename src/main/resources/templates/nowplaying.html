<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phim ƒêang Chi·∫øu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .movie-card {
            min-width: 200px;
            max-width: 200px;
            text-align: center;
        }

        .movie-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
        }

        .section-title {
            font-size: 1.5rem;
            margin: 20px 0;
        }

        .movie-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
    </style>
</head>

<body>
<div class="main-container">
    <div th:replace="components/header :: header">
        <!-- N·∫øu s·ª≠ d·ª•ng Thymeleaf, h√£y ƒë·∫£m b·∫£o file header.html n·∫±m trong th∆∞ m·ª•c ƒë√∫ng -->
    </div>
    <!-- Now Playing Movies Section -->
    <div class="container my-5">
        <h2 class="section-title text-center">üé• Phim ƒêang Chi·∫øu</h2>
        <div id="now-playing-movies" class="movie-section">
            <!-- S·ª≠ d·ª•ng Thymeleaf ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch phim -->
            <th:block th:each="movie : ${movies}">
                <div class="movie-card">
                    <a th:href="@{/details(movieId=${movie.id})}" style="text-decoration: none; color: inherit;">
                        <img th:src="@{'https://image.tmdb.org/t/p/w500' + ${movie.poster_path}}" th:alt="${movie.title}">
                        <h6 th:text="${movie.title}"></h6>
                        <p>
                            <strong>‚≠ê</strong>
                            <span th:text="${movie.vote_average}"></span> / 10
                            | (<span th:text="${movie.vote_count}">0</span> votes)
                        </p>
                        <p><small>Ng√†y chi·∫øu: <span th:text="${movie.release_date}">N/A</span></small></p>
                    </a>
                </div>
            </th:block>
        </div>
    </div>
</div>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript Fetch API -->
<script>
    const API_KEY = '5b3554c90c5c911c652788f8b65db269';
    const BASE_URL = 'https://api.themoviedb.org/3';

    // L·∫•y tham s·ªë ng√¥n ng·ªØ t·ª´ URL
    const params = new URLSearchParams(window.location.search);
    const lang = params.get('lang') || 'vi'; // M·∫∑c ƒë·ªãnh l√† 'vi'

    // G·ªçi API ƒë·ªÉ l·∫•y phim ƒêang Chi·∫øu
    async function fetchNowPlayingMovies() {
        const apiUrl = `${BASE_URL}/movie/now_playing?api_key=${API_KEY}&language=${lang}`;

        try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            displayMovies(data.results);
        } catch (error) {
            console.error('L·ªói khi l·∫•y phim ƒëang chi·∫øu:', error);
            document.getElementById('now-playing-movies').innerHTML = '<p class="text-danger">Kh√¥ng th·ªÉ t·∫£i danh s√°ch phim.</p>';
        }
    }

    // Hi·ªÉn th·ªã danh s√°ch phim
    function displayMovies(movies) {
        const container = document.getElementById('now-playing-movies');
        container.innerHTML = '';

        if (movies.length === 0) {
            container.innerHTML = '<p class="text-center" th:text="#{now-playing-movies.no_movies}">Kh√¥ng c√≥ phim n√†o ƒëang chi·∫øu.</p>';
            return;
        }

        movies.forEach(movie => {
            const movieCard = document.createElement('div');
            movieCard.className = 'movie-card';
            movieCard.innerHTML = `
                <a href="/details?movieId=${movie.id}" style="text-decoration: none; color: inherit;">
                    <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
                    <h6>${movie.title}</h6>
                    <p><strong>‚≠ê</strong> ${movie.vote_average} / 10 | (${movie.vote_count || '0'} votes)</p>
                    <p><strong>üìÖ Ng√†y chi·∫øu:</strong> ${movie.release_date || 'N/A'}</p>
                </a>
            `;
            container.appendChild(movieCard);
        });
    }

    // G·ªçi API khi t·∫£i trang
    fetchNowPlayingMovies();
</script>

</body>
</html>
