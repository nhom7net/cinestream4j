<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Danh s√°ch xem</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2>üì∫ Danh s√°ch phim ƒë√£ l∆∞u</h2>

    <!-- Hi·ªÉn th·ªã l·ªói n·∫øu c√≥ -->
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Ki·ªÉm tra danh s√°ch r·ªóng -->
    <div th:if="${#lists.isEmpty(watchlist)}" class="alert alert-info">
        B·∫°n ch∆∞a th√™m phim n√†o v√†o danh s√°ch.
    </div>

    <!-- Hi·ªÉn th·ªã danh s√°ch phim -->
    <table th:if="${!#lists.isEmpty(watchlist)}" class="table table-striped">
        <thead>
        <tr>
            <th>Movie ID</th>
            <th>H√†nh ƒë·ªông</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${watchlist}">
            <td th:text="${item.movieId}"></td>
            <td>
                <a th:href="@{'/movies/' + ${item.movieId}}" class="btn btn-primary btn-sm">Xem chi ti·∫øt</a>
                <button class="btn btn-danger btn-sm" onclick="removeFromList('[[${item.movieId}]]')">X√≥a</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- X·ª≠ l√Ω x√≥a phim kh·ªèi danh s√°ch -->
<script>
    async function removeFromList(movieId) {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phim n√†y kh·ªèi danh s√°ch?")) {
            try {
                const response = await fetch('/watchlist/remove', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({movieId: movieId})
                });

                const result = await response.json();

                if (response.ok) {
                    alert(result.message);
                    location.reload();
                } else {
                    alert(result.message);
                }
            } catch (error) {
                console.error('L·ªói:', error);
                alert('ƒê√£ x·∫£y ra l·ªói khi x√≥a phim.');
            }
        }
    }
</script>
</body>
</html>
